"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["ui_packages_code-view-shared_components_files-search_FileResultsList_tsx"],{64876:(e,t,r)=>{r.d(t,{V:()=>WebWorker});let WebWorker=class WebWorker{set onmessage(e){this.worker.onmessage=e}postMessage(e){this.worker.postMessage(e)}terminate(){this.worker.terminate()}constructor(e,t){try{this.worker=new Worker(e)}catch(e){console.warn("Web workers are not available. Please enable web workers to benefit from the improved performance."),this.worker=new MainThreadWorker(t)}}};let MainThreadWorker=class MainThreadWorker{async postMessage(e){if(this.terminated)return;let t={data:this.job({data:e})};this.onmessage?.(t)}terminate(){this.terminated=!0}constructor(e){this.job=e,this.terminated=!1}}},52845:(e,t,r)=>{r.r(t),r.d(t,{FileResultRow:()=>H,default:()=>W});var a=r(85893),s=r(56875),l=r(40961),i=r(37227),n=r(63625),o=r(52171),c=r(26888),u=r(34430),d=r(37478),f=r(80222),h=r(10800),m=r(26935),p=r(13275),x=r(85529),g=r(17840),v=r(42483),w=r(51461),b=r(52972),y=r(73290),R=r(2708),j=r(74121),C=r(98833),E=r(97011),S=r(47142),k=r(67294),N=r(64876),F=r(15205);let L=(0,F.Z)(S.Gs);function I({data:e}){let{query:t,baseList:r,startTime:a}=e,s=t.replaceAll("\\","");return{query:t,list:r.filter(e=>""===s||(0,S.CD)(s,e)&&L(s,e)>0).sort((e,t)=>L(s,t)-L(s,e)),baseCount:r.length,startTime:a}}var A=r(94504),T=r(26415);async function _(e){let t=await (0,T.v5)(e);return t.ok?await t.json():void 0}let Z=new Map,D=(0,F.Z)(_,{cache:Z}),M={excludeDirectories:!1,excludeSeeAllResults:!1};function W({actionListSx:e={},commitOid:t,config:r=M,findFileWorkerPath:d,getItemUrl:x,onRenderRow:j,onItemSelected:C,searchBoxRef:E,sx:S={}}){let{excludeDirectories:F,excludeSeeAllResults:L}=r,{query:T,setQuery:_}=(0,s.aM)(),Z=(0,o.H)(),W=k.useRef(null),H=E??W,[q,V]=k.useState(T.length>0),[B,G]=k.useState(!!T),{list:O,directories:P,loading:K,error:U}=function(e,t,r){let a=(0,o.H)(),[s,l]=(0,k.useState)({list:[],directories:[],loading:!0}),i=(0,u.a_)({repo:a,commitOid:e,includeDirectories:!r});return(0,k.useEffect)(()=>{let e=!1,r=async()=>{l({list:[],directories:[],loading:!0});let t=await D(i);if(e)return;let r=t?.paths||[],a=t?.directories||[];l({list:r.concat(a).sort(),directories:a,error:!t})};return t&&r(),function(){e=!0}},[i,t,r]),s}(t,q,!!F),{path:Y}=(0,l.Br)(),{getUrl:Q}=(0,n.B)(),{queryText:X,queryLine:J}=function(e){let t=(e=e.replaceAll(" ","")).indexOf(":");return t>=0?{queryText:e.substring(0,t),queryLine:parseInt(e.substring(t+1),10)}:{queryText:e,queryLine:void 0}}(T),{matches:ee,clearMatches:et}=function(e,t,r,a){let[s,l]=k.useState(),n=k.useRef(""),o=k.useRef(),{sendStats:c}=(0,i.a)(),u=k.useRef(!1),d=k.useCallback(()=>{let e=new N.V(r,I);e.onmessage=({data:e})=>{u.current=!1,l(e.list),n.current=e.query,e.startTime&&c("repository.find-file",{"find-file-base-count":e.baseCount,"find-file-results-count":e.list.length,"find-file-duration-ms":performance.now()-e.startTime})},o.current=e},[c,r]);return k.useEffect(()=>{if(a)return d(),function(){o.current?.terminate()}},[d,a]),k.useEffect(()=>{if(e.length&&t){u.current&&(o.current?.terminate(),d());let r=n.current&&t.startsWith(n.current);u.current=!0,o.current?.postMessage({baseList:r&&s||e,query:t,startTime:performance.now()})}},[e,t,d]),{matches:s,clearMatches:()=>l(void 0)}}(O,X,d,q),{sendRepoClickEvent:er}=(0,i.a)(),ea=(0,h.s)(),[es,el]=k.useState(0),[ei,en]=k.useState((0,A.$)()),eo=k.useRef(null),ec=k.useRef(null),eu="file-results-list",{sendRepoKeyDownEvent:ed}=(0,i.a)(),{screenSize:ef}=(0,f.eI)(),eh=r.useOverlay??ef>=f._G.large,em=k.useCallback(()=>{er("FILE_TREE.SEARCH_RESULT_CLICK"),C?.(),G(!1)},[er,C]),ep=(e,t,r)=>x?x(e,t,r):Q({path:e,action:t?"tree":"blob",hash:r}),{containerRef:ex}=(0,g.v)({bindKeys:m.Qw.ArrowVertical|m.Qw.HomeAndEnd,focusInStrategy:"previous"},[K,U]);k.useEffect(()=>{T||G(!1)},[T]),k.useEffect(()=>{document.activeElement!==H.current&&eh&&G(!1)},[Y,H,eh]);let eg=ee?.slice(0,40)||[],ev=ee&&ee.length>eg.length,ew=(0,a.jsx)(v.Z,{sx:{maxHeight:eh?"60vh":"100% !important",overflowY:"auto",scrollbarGutter:"stable",maxWidth:"100vw","@media (max-width: 768px)":{ml:3,mr:2}},children:U?(0,a.jsx)(w.Z,{variant:"danger",className:"m-3",children:"Failed to search"}):(0,a.jsxs)(b.S,{ref:ex,sx:{overflow:"auto",p:eh?2:3,width:"100%",pr:eh?3:0,pt:eh?3:"2px !important",...e},role:"listbox",children:[!K&&eg.map((e,t)=>{let r=P.includes(e),s=ep(e,r,J?`L${J}`:"");return(0,a.jsx)(z,{active:e===Y,index:t,focused:ei&&es===t,match:e,onRender:j,query:X,onClick:em,isDirectory:r,to:s,useOverlay:eh,listRef:ex},e)}),(0,a.jsxs)("div",{className:"m-3 text-center",children:[(0,a.jsx)($,{loading:K||!ee,visibleResultCount:eg.length,truncated:!!ev}),ev&&!L&&(0,a.jsxs)(a.Fragment,{children:["\xa0",(0,a.jsx)(y.Z,{id:"see-all-results-link",className:"focus-visible",ref:eo,href:(0,u.mY)({owner:Z.ownerLogin,repo:Z.name,searchTerm:`path:${X}`}),sx:ei&&es===eg.length?{outline:"2px solid var(--focus-outlineColor, var(--color-accent-fg))",outlineOffset:"-2px",boxShadow:"none"}:{},children:"See all results"})]})]})]})});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.Z,{ref:ec,sx:{mx:2,ml:3,...S},children:(0,a.jsx)(A.f,{ariaActiveDescendant:(!eh&&T||eh&&B)&&ei&&es>-1?ev&&es===eg.length?"see-all-results-link":`file-result-${es}`:void 0,ariaExpanded:eh?B:void 0,ariaHasPopup:eh,ariaControls:eh?eu:void 0,ref:H,query:T,onKeyDown:e=>{let{key:t,shiftKey:r,metaKey:a,altKey:s,ctrlKey:l}=e;if(!r&&!a&&!s){if("Escape"===t)T?(ed("FILE_TREE.CANCEL_SEARCH"),_(""),et()):document.activeElement&&document.activeElement.blur();else if(!T)return;else if("Enter"===t)!L&&ev&&es===eg.length?(ea((0,u.mY)({owner:Z.ownerLogin,repo:Z.name,searchTerm:`path:${X}`})),C?.()):eg[es]&&(ea(ep(eg[es],!1,J?`L${J}`:"")),G(!1),C?.());else if("ArrowDown"===t||l&&"n"===t){if(!L&&ev&&es>=eg.length-1){if(el(eg.length),eo.current&&ex.current){let e=(0,c.M)(ex.current);(0,p.z)(eo.current,e,{behavior:"instant"})}}else el(Math.min(es+1,eg.length-1));e.preventDefault();return}else if("ArrowUp"===t||l&&"p"===t){el(Math.max(es-1,0)),e.preventDefault();return}}},onPreload:()=>V(!0),onSearch:e=>{_(e),e?G(!0):(et(),G(!1)),el(0)},onBlur:e=>{ex.current?.contains(e.relatedTarget)||(G(!1),en(!1))},onFocus:()=>{T&&G(!0),en(!0)},sx:{minWidth:"160px"}})}),eh&&(0,a.jsx)(R.w,{anchorRef:ec,open:eh&&B,renderAnchor:null,onClose:()=>{G(!1)},focusZoneSettings:{disabled:!0},focusTrapSettings:{disabled:!0},width:"xlarge",align:"end",overlayProps:{id:eu,role:"dialog"},children:ew}),!eh&&T&&ew]})}function $({visibleResultCount:e,truncated:t,loading:r}){return(0,a.jsx)("span",{role:"status",className:r||t||0===e?void 0:"sr-only","aria-label":r?"Loading":void 0,children:r?(0,a.jsx)(j.Z,{size:"large"}):0===e?"No matches found":t?`First ${e} files shown.`:`Showing ${e} files.`},"results-count-status")}let H=({active:e,focused:t,index:r,match:s,query:l,to:i,isDirectory:n,onClick:o,onRender:u,useOverlay:f,listRef:h})=>{let m=(0,S.m7)(l,s);u?.();let x=k.useRef(null),g=n?q:V;k.useEffect(()=>{if(t&&x.current&&h?.current){let e=(0,c.M)(h.current);(0,p.z)(x.current,e,{behavior:"instant"})}},[t,h]);let w={};return t&&(w={outline:"none",border:"2 solid",boxShadow:"0 0 0 2px #0969da"}),(0,a.jsx)(b.S.Item,{id:`file-result-${r}`,ref:x,as:d.r,onSelect:o,to:i,active:e,sx:{fontWeight:"normal",":hover":{textDecoration:"none"},mx:"2px",width:"calc(100% - 4px)",...w},role:"option","data-focus-visible-added":t||void 0,tabIndex:f?-1:0,children:(0,a.jsxs)("div",{className:"d-flex",children:[(0,a.jsx)("div",{className:"d-flex flex-1 flex-column overflow-hidden",children:(0,a.jsx)(B,{text:s,positionsList:m,sx:{color:"fg.muted"},LeadingIcon:g})}),t&&(0,a.jsx)(v.Z,{sx:{pl:1,whiteSpace:"nowrap",color:"fg.muted"},children:`Go to ${n?"folder":"file"}`})]})},s)},q=()=>(0,a.jsx)(C.Z,{"aria-label":"Directory",icon:x.FileDirectoryFillIcon,sx:{color:"var(--treeViewItem-leadingVisual-iconColor-rest, var(--color-icon-directory))",mr:2},size:"small"}),V=()=>(0,a.jsx)(C.Z,{"aria-label":"File",icon:x.FileIcon,className:"fgColor-muted mr-2",size:"small"}),z=k.memo(H);function B({text:e,positionsList:t,sx:r,LeadingIcon:s}){let l=[],i=0;for(let r of t){if(Number(r)!==r||r<i||r>e.length)continue;let t=e.slice(i,r);t&&l.push(G(t)),i=r+1,l.push((0,a.jsx)(E.Z,{as:"mark",className:"text-bold bgColor-transparent fgColor-default",children:e[r]},r))}return l.push(G(e.slice(i))),(0,a.jsx)(v.Z,{sx:r,children:(0,a.jsxs)(a.Fragment,{children:[s&&(0,a.jsx)(s,{}),l]})})}function G(e){return e.replaceAll("/","/\u200B")}try{W.displayName||(W.displayName="FileResultsList")}catch{}try{$.displayName||($.displayName="FileResultsStatus")}catch{}try{H.displayName||(H.displayName="FileResultRow")}catch{}try{q.displayName||(q.displayName="DirectoryIcon")}catch{}try{V.displayName||(V.displayName="FileResultIcon")}catch{}try{z.displayName||(z.displayName="MemoizedFileResultRow")}catch{}try{B.displayName||(B.displayName="HighlightMatch")}catch{}},94504:(e,t,r)=>{r.d(t,{$:()=>h,f:()=>f});var a=r(85893),s=r(46263),l=r(79693),i=r(37227),n=r(930),o=r(85529),c=r(14626),u=r(42483),d=r(67294);let f=d.forwardRef(({ariaActiveDescendant:e,ariaControls:t,ariaExpanded:r,ariaHasPopup:n,onBlur:f,onFocus:m,onKeyDown:p,onPreload:x,onSearch:g,query:v,sx:w={}},b)=>{let{sendRepoClickEvent:y}=(0,i.a)(),[R,j]=d.useState(v),C=d.useRef((0,s.D)(e=>g(e),250));d.useEffect(()=>{j(v)},[v]);let E=v?(0,a.jsx)(c.Z.Action,{onClick:()=>{y("FILE_TREE.CANCEL_SEARCH"),g("")},icon:o.XCircleFillIcon,"aria-label":"Clear",className:"fgColor-muted"}):void 0;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(c.Z,{autoFocus:h(),ref:b,value:R,onKeyDown:p,onChange:e=>{j(e.target.value),x(),C.current(e.target.value)},sx:{display:"flex",...w},"aria-label":"Go to file","aria-activedescendant":e,role:n?"combobox":void 0,"aria-controls":t,"aria-expanded":r,"aria-haspopup":n?"dialog":void 0,autoCorrect:"off",spellCheck:"false",placeholder:"Go to file",leadingVisual:o.SearchIcon,trailingAction:E,trailingVisual:E?void 0:()=>(0,a.jsx)(l.I,{children:(0,a.jsx)(u.Z,{sx:{mr:"-6px"},children:(0,a.jsx)("kbd",{children:"t"})})}),onFocus:e=>{x(),e.target.select(),m?.(e)},onBlur:f,onClick:()=>y("FILE_TREE.SEARCH_BOX")})})});function h(){return"1"===new URLSearchParams(n.ssrSafeLocation.search).get("search")}f.displayName="FilesSearchBox"}}]);
//# sourceMappingURL=ui_packages_code-view-shared_components_files-search_FileResultsList_tsx-9206d123bb64.js.map